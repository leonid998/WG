# 3X-UI VPN - Docker Compose конфигурация
#
# ВАЖНО: При использовании network_mode: host
# порты НЕ указываются в секции ports - контейнер
# использует сеть хоста напрямую.
#
# Порты настраиваются в панели 3X-UI:
# - Панель управления: 39847 (изменён с дефолтного 2053)
# - VPN (VLESS+Reality): 8443 (изменён с 443 из-за блокировок)

services:
  3x-ui:
    image: ghcr.io/mhsanaei/3x-ui:latest
    container_name: 3x-ui
    restart: unless-stopped
    volumes:
      - ./data/db:/etc/x-ui/          # SQLite база данных и конфигурация
      - ./data/cert:/root/cert/       # SSL сертификаты для Reality
    environment:
      - XRAY_VMESS_AEAD_FORCED=false  # Совместимость с клиентами
    network_mode: host                # Использует сеть хоста напрямую

# ВАЖНО:
# 1. После первого запуска сменить пароль администратора
# 2. Настроить VLESS+Reality inbound на порту 8443
# 3. Установить IP Limit = 1 для ограничения устройств
# 4. Резервное копирование: docker cp 3x-ui:/etc/x-ui/x-ui.db ./backup/
#
# Firewall (UFW) - открыть порты:
# ufw allow 39847/tcp  # Панель управления
# ufw allow 8443/tcp   # VPN
# ufw allow 8443/udp   # VPN (QUIC)
