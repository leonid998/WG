# Сравнение VPN панелей: Marzban vs 3X-UI

**Дата исследования:** 11 декабря 2025
**Назначение:** Выбор готового решения для VPN на базе XRay VLESS+Reality
**Требования:** VLESS+Reality, Docker, лимит устройств (1 пользователь = 1 устройство), учет трафика, QR-коды

---

## Сравнительная таблица

| Критерий | Marzban | 3X-UI | Примечание |
|----------|---------|-------|-----------|
| **БД** | SQLite, MySQL, MariaDB | SQLite | Marzban рекомендует MySQL при 50+ пользователей |
| **Лимит устройств** | ❌ Нет встроенного | ✅ ДА (IP Limit) | Marzban требует luIP-marzban |
| **Docker** | ✅ Полная поддержка | ✅ Полная поддержка | Оба имеют Dockerfile и docker-compose |
| **VLESS+Reality** | ✅ Поддерживает | ✅ Поддерживает | Оба готовы для обхода блокировок |
| **QR-коды** | ✅ Автогенерация | ✅ Генерация | Есть известные баги в 3X-UI v2.6.6+ |
| **Учет трафика** | ✅ ДА | ✅ ДА | Оба отслеживают и ограничивают |
| **Multi-node** | ✅ ДА (Marzban Node) | ❌ НЕТ | Marzban может управлять несколькими серверами |
| **REST API** | ✅ ДА | ❓ Не упомянуто | Marzban удобнее для автоматизации |
| **Telegram Bot** | ✅ ДА | ❌ НЕТ | Marzban имеет встроенную интеграцию |
| **Простота конфигурации** | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 3X-UI проще в настройке UI |
| **Активность разработки** | ✅ Активная | ✅ Активная | Оба поддерживаются |
| **Официальная рекомендация** | ✅ Рекомендуется Xcore | ⚠️ Есть предупреждения | Marzban предпочитается разработчиками Xray |

---

## Детальный анализ

### Marzban

**Преимущества:**
- ✅ Встроенное управление несколькими серверами (Marzban Node) — добавлены новые серверы автоматически синхронизируют пользователей
- ✅ REST API для программной интеграции
- ✅ Telegram bot для управления и уведомлений
- ✅ Гибкая выбор БД (SQLite/MySQL/MariaDB)
- ✅ Поддержка multiple protocols на одного пользователя
- ✅ Fallback механизмы на одном порту
- ✅ Официально рекомендуется разработчиками Xray

**Недостатки:**
- ❌ Нет встроенного ограничения на количество устройств (требуется 3rd-party решение luIP-marzban)
- ⚠️ luIP-marzban использует iptables и требует запуска как отдельный сервис
- ⚠️ Более сложная архитектура
- ⚠️ Сложнее начальная конфигурация

**Рекомендуется для:**
- Распределённые инфраструктуры с несколькими серверами
- Крупные установки (50+ пользователей)
- Требуется REST API интеграция
- Нужен Telegram bot

---

### 3X-UI

**Преимущества:**
- ✅ Встроенный IP Limit (ограничение одного устройства на пользователя)
- ✅ Очень простая конфигурация через веб-интерфейс
- ✅ Не требует дополнительных инструментов для лимита устройств
- ✅ Хорошая производительность для single-server
- ✅ Легко развернуть в Docker

**Недостатки:**
- ❌ Нет multi-node (каждый сервер — отдельная панель)
- ❌ Требует fail2ban для работы IP Limit
- ❌ Известные баги с QR-кодами в версиях v2.6.6+
- ⚠️ **ПРЕДУПРЕЖДЕНИЕ БЕЗОПАСНОСТИ**: Разработчики Xray рекомендуют НЕ использовать 3X-UI с plain HTTP (нужно обязательно включить HTTPS)
- ❌ Нет REST API для автоматизации
- ❌ Нет Telegram bot
- ❌ SQLite не рекомендуется при большом количестве пользователей

**Рекомендуется для:**
- Single-server setup
- Малые и средние установки (до 50 пользователей)
- Требование: 1 пользователь = 1 устройство (IP Limit)
- Простота конфигурации важнее расширяемости

---

## Рекомендация

### ✅ Выбрать **3X-UI**, если:

1. **Нужен встроенный лимит одного устройства на пользователя**
   - IP Limit встроен в панель
   - Требует только установки fail2ban

2. **Single-server инфраструктура**
   - Один VPN сервер — один пользователь

3. **Простота важнее всего**
   - Конфигурация полностью через веб-интерфейс
   - Не нужны дополнительные инструменты

4. **Малое количество пользователей** (до 50)

### ✅ Выбрать **Marzban**, если:

1. **Нужна multi-server инфраструктура**
   - Несколько географически распределённых серверов
   - Централизованное управление пользователями

2. **Требуется REST API**
   - Программная интеграция
   - Автоматизация процессов

3. **Нужен Telegram bot**
   - Управление через бот
   - Уведомления в Telegram

4. **Большое количество пользователей** (50+)

---

## Рекомендуемая архитектура для ваших требований

### Вариант 1: Простой (3X-UI)

```yaml
Архитектура:
  - 1 VPN сервер (Hetzner, Финляндия)
  - 3X-UI панель управления
  - fail2ban для IP Limit (1 устройство = 1 пользователь)

Преимущества:
  - Быстрая установка (1-2 часа)
  - Простая конфигурация
  - Встроенный лимит устройств

Недостатки:
  - Нет масштабируемости
  - Один сервер = одна точка отказа
```

### Вариант 2: Масштабируемый (Marzban)

```yaml
Архитектура:
  - 1+ VPN серверов (разные страны)
  - 1 главная Marzban панель (управление)
  - N Marzban Node на каждом сервере
  - luIP-marzban для лимита устройств
  - Telegram bot для управления

Преимущества:
  - Масштабируемость
  - Высокая доступность
  - Централизованное управление
  - Программная интеграция

Недостатки:
  - Сложнее в настройке
  - Дороже в обслуживании
```

---

## Установка и конфигурация

### 3X-UI Docker установка (простая)

```bash
# 1. Создать директории для хранения данных
mkdir -p ~/3x-ui/{db,cert}

# 2. Запустить контейнер
docker run -itd \
  -e XRAY_VMESS_AEAD_FORCED=false \
  -v ~/3x-ui/db:/etc/x-ui/ \
  -v ~/3x-ui/cert:/root/cert/ \
  --network=host \
  --restart=unless-stopped \
  --name 3x-ui \
  ghcr.io/mhsanaei/3x-ui:latest

# 3. Проверить статус
docker logs 3x-ui

# 4. Перейти на http://SERVER_IP:54321
# Логин по умолчанию: admin / admin
# ВАЖНО: Сменить пароль сразу!
```

### Marzban Docker установка (сложнее)

```bash
# 1. Получить скрипт установки
curl -sL https://github.com/Gozargah/Marzban-scripts/raw/master/marzban.sh | sudo bash -s install

# 2. Конфигурация в /opt/marzban/.env

# 3. Запуск
sudo systemctl start marzban

# 4. Веб-интерфейс: http://SERVER_IP:8010
```

---

## Финальное решение

### Для вашего случая рекомендую **3X-UI**:

**Причины:**
1. ✅ Встроенный IP Limit (1 устройство = 1 пользователь)
2. ✅ VLESS+Reality поддержка
3. ✅ Docker развертывание
4. ✅ Простота конфигурации
5. ✅ Быстрое развертывание (1-2 часа)
6. ✅ Все требуемые функции (QR, трафик, лимиты)

**После развертывания:**
1. Установить fail2ban для IP Limit
2. Включить HTTPS (обязательно!)
3. Сменить пароль администратора
4. Настроить VLESS+Reality inbound
5. Добавить пользователей с IP Limit = 1

---

## Источники

- [Marzban GitHub](https://github.com/Gozargah/Marzban)
- [3X-UI GitHub](https://github.com/MHSanaei/3x-ui)
- [Marzban документация](https://gozargah.github.io/marzban/)
- [3X-UI Wiki](https://github.com/MHSanaei/3x-ui/wiki)
- [luIP-marzban](https://github.com/mmdzov/luIP-marzban)
- [VLESS+Reality в Xray](https://github.com/XTLS/Xray-core)
